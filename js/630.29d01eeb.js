"use strict";(self["webpackChunkrujiayouxuan"]=self["webpackChunkrujiayouxuan"]||[]).push([[630],{3630:function(o,s,t){t.r(s),t.d(s,{default:function(){return f}});var i=function(){var o=this,s=o._self._c;return s("div",{staticClass:"detail"},[s("div",{staticClass:"retbtn",on:{click:o.retClick}},[s("span",{staticClass:"iconfont icon-zuo"})]),s("div",{staticClass:"det-img"},[s("van-image",{attrs:{src:o.goodsInfo.img,width:"100%",height:"100%"},scopedSlots:o._u([{key:"loading",fn:function(){return[s("van-loading",{attrs:{type:"spinner",size:"20"}})]},proxy:!0},{key:"error",fn:function(){return[o._v("加载失败")]},proxy:!0}])})],1),s("div",{staticClass:"goodsdetail"},[s("div",{staticClass:"goodsprice"},[o._v(" ¥"),s("span",[o._v(o._s(o.goodsInfo.price))])]),s("div",{staticClass:"goodsname"},[o._v(o._s(o.goodsInfo.name))]),o._m(0)]),s("div",{staticClass:"select",on:{click:o.openShow}},[s("span",[o._v("选择")]),s("div",{staticClass:"name"},[o._v(" "+o._s(o.goodsInfo.color?o.goodsInfo.color:"")+" "+o._s(o.goodsInfo.gg?o.goodsInfo.gg:"")+" ")]),s("span",{staticClass:"iconfont icon-you"})]),s("van-sku",{ref:"skuRef",attrs:{sku:o.sku,goods:o.goods,"goods-id":o.goodsId},on:{"buy-clicked":o.onBuyClicked,"add-cart":o.onAddCartClicked},model:{value:o.show,callback:function(s){o.show=s},expression:"show"}}),s("van-goods-action",[s("van-goods-action-icon",{attrs:{icon:"cart-o",text:"购物车",badge:o.list.length},on:{click:o.gotoShoppingcar}}),s("van-goods-action-icon",{attrs:{icon:"star-o",text:"收藏"}}),s("van-goods-action-button",{attrs:{type:"warning",text:"加入购物车"},on:{click:o.openShow}}),s("van-goods-action-button",{attrs:{type:"danger",text:"立即购买"}})],1)],1)},e=[function(){var o=this,s=o._self._c;return s("div",{staticClass:"goodsmsg"},[s("div",[o._v("快递：0.0")])])}],d=t(2932),n=t(3822),a=t(5687),r={query:o=>(0,a.Z)({url:"/goodsdetail",method:"get",params:o}),querySearch:o=>(0,a.Z)({url:"/searchresult",method:"get",params:o})},c=t(2534),g={mixins:[d.Z],computed:{...(0,n.rn)(["userinfo"]),...(0,n.rn)("shoppingcar",["list"])},data(){return{goodsInfo:{},show:!1,goods:{picture:""},goodsId:0,sku:{tree:[{k:"颜色",k_s:"s1",v:[{}]},{k:"规格",k_s:"s2",v:[{}]}],list:[{}],price:"1.00",stock_num:1e3,hide_stock:!0}}},async created(){let{data:o}=await r.querySearch({goodsId:this.$route.params.id});this.goodsInfo=o[0]},methods:{...(0,n.nv)("shoppingcar",["updateCarList","addCarList"]),retClick(){this.$router.go(-1)},onBuyClicked(){},async onAddCartClicked(o){if(!this.$store.state.userinfo.id)return this.$router.push("/login"),!1;let s=o.selectedSkuComb.s1,t=o.selectedSkuComb.s2,i=o.selectedNum,e=this.goodsInfo.goodsId,d=this.userinfo.id,{data:n}=await c.Z.query({userid:d,goodsid:e,ggid:t,colorid:s});if(n.length)this.updateCarList({num:n[0].num+i,carId:n[0].id});else{let n=this.sku.tree[0].v.filter((o=>o.id==s))[0].name,a=this.sku.tree[1].v.filter((o=>o.id==t))[0].name,r=this.goodsInfo.name,c=o.selectedSkuComb.price/100,g=this.goodsInfo.img;this.addCarList({goodsid:e,goodsname:r,userid:d,colorid:s,colorname:n,ggid:t,ggname:a,price:c,img:g,num:i})}this.$toast.success("加入成功"),this.show=!1},async openShow(){if(this.show=!0,this.goodsInfo.goodsId){this.goodsId=this.goodsInfo.goodsId;let{data:o}=await r.query({goodsid:this.goodsInfo.goodsId});if(this.goods.picture=this.goodsInfo.img,o.length){let s=Array.from(new Set(o.map((o=>o.colorid)))),t=s.map((s=>{let t=o.filter((o=>o.colorid==s))[0];return{id:s,name:t.colorname}}));this.sku.tree[0].v=t;let i=Array.from(new Set(o.map((o=>o.ggid)))),e=i.map((s=>{let t=o.filter((o=>o.ggid==s))[0];return{id:s,name:t.ggname}}));this.sku.tree[1].v=e;let d=o.map((o=>({id:o.id,s1:o.colorid,s2:o.ggid,price:100*o.price,stock_num:o.num})));this.sku.list=d}else this.goodsId=this.goodsInfo.goodsId,this.goods.picture=this.goodsInfo.img,this.goodsInfo.color&&(this.sku.tree[0].v=[{id:1,name:this.goodsInfo.color}]),this.goodsInfo.gg&&(this.sku.tree[1].v=[{id:1,name:this.goodsInfo.gg}]),this.sku.list[0]={id:1,s1:1,s2:1,price:100*this.goodsInfo.price,stock_num:100},this.sku.price=this.goodsInfo.price}else this.$router.push("/home")},gotoShoppingcar(){this.$store.state.userinfo.id?this.$router.push("/shoppingcar"):(this.$toast("请先登录哦"),this.$router.push("/login"))}}},u=g,l=t(1001),h=(0,l.Z)(u,i,e,!1,null,"7d6e8f79",null),f=h.exports},2932:function(o,s){s["Z"]={mounted(){this.$store.commit("isShowTabbar",!1)},destroyed(){this.$store.commit("isShowTabbar",!0)}}}}]);
//# sourceMappingURL=630.29d01eeb.js.map